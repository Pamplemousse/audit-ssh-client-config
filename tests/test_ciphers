#
# Ciphers
#
# Allowed symetric ciphers:
# chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,
# aes256-ctr,aes192-ctr,aes128-ctr
#
test_ciphers_different_from_allowed_ones_on_a_specific_host_returns_a_warning() {
  cat << __EOF__ >"fake_bad_config"
Host hostname.com
  Ciphers weak-cipher,aes128-ctr,other-weak-cipher
__EOF__

  ../main fake_bad_config > result
  expected_message="WARNING: Ciphers 'weak-cipher' should be avoided for host hostname.com"
  expected_second_message="WARNING: Ciphers 'other-weak-cipher' should be avoided for host hostname.com"

  assert 'grep "$expected_message" result'
  assert 'grep "$expected_second_message" result'
}

test_kexalgorithms_different_from_allowed_ones_on_star_host_returns_an_error() {
  cat << __EOF__ >"fake_bad_config"
Host *
  Ciphers weak-cipher,aes128-ctr,other-weak-cipher
__EOF__

  ../main fake_bad_config > result
  expected_message="ERROR: Ciphers 'weak-cipher' should be avoided for host \*"
  expected_second_message="ERROR: Ciphers 'other-weak-cipher' should be avoided for host \*"

  assert 'grep "$expected_message" result'
  assert 'grep "$expected_second_message" result'
}

test_missing_ciphers_on_star_host_returns_an_error() {
  cat << __EOF__ >"fake_bad_config"
Host *
  Username yoloer
__EOF__

  ../main fake_bad_config > result
  expected_message="ERROR: Ciphers are missing for host \*"

  assert 'grep "$expected_message" result'
}
